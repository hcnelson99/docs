<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta name="generator" content="Madoko, version 0.9.2-beta" />
  <meta name="viewport" content="initial-scale=1.0" />
  <meta name="author" content="Jonathan Aldrich" />
  <title>Guide to Programming in Wyvern</title>
  <style  class="link">
/* ---------------------------------------------------
   Various settings to display madoko elements correctly.
   For example, lines in tables or a table of contents.

   All rules use specific madoko classes and never just
   a generic element. This means one can safely include
   this CSS into any web page without affecting non-madoko
   content.
----------------------------------------------------*/

/* The table of  contents */
.madoko .toc>.tocblock .tocblock .tocblock {
  margin-left: 2.5em;
}

.madoko .toc>.tocblock .tocblock {
  margin-left: 1.7em;
}

.madoko .toc>.tocblock>.tocitem {
  font-weight: bold;
}

.madoko .toc {
  margin-top: 1em;
}

/* Paragraphs */
.madoko p.para-continue {
  margin-bottom: 0pt;
}

.madoko .para-block+p {
  margin-top: 0pt;
}

.madoko ul.para-block, .madoko ol.para-block {
  margin-top: 0pt;
  margin-bottom: 0pt;
}

.madoko ul.para-end, .madoko ol.para-end {
  margin-bottom: 1em;
}

.madoko dl {
  margin-left: 0em;
}

.madoko blockquote {
  border-left: 5px Gainsboro solid;
  padding-left: 1ex;
  margin-left: 1em;
}

/* Local page links do not get an underline unless hovering */
.madoko a.localref {
  text-decoration: none;
}
.madoko a.localref:hover {
  text-decoration: underline;
}

/* Footnotes */
.madoko .footnotes {
  font-size: smaller;
  margin-top: 2em;
}

.madoko .footnotes hr {
  width: 50%;
  text-align: left;
}

.madoko .footnote { 
  margin-left: 1em;
}
.madoko .footnote-before {
  margin-left: -1em;
  width: 1em;
  display: inline-block;
}

/* Abstract */
.madoko .abstract>p:first-child:before {
  content: "Abstract. ";
  font-weight: bold;
}

.madoko .abstract {
  margin-left: 2.7em;
  margin-right: 2.7em;
  font-size: small;
}


/* Alignment */
.madoko .align-center, .madoko .align-center>p {
  text-align: center !important;
}

.madoko .align-center pre {
  text-align: left;
}

.madoko .align-center>* {
  margin-left: auto !important;
  margin-right: auto !important;
}

.madoko .align-left, .madoko .align-left>p {
  text-align: left !important;
}

.madoko .align-left>* {
  margin-left: 0pt !important;
  margin-right: auto !important;
}

.madoko .align-right, .madoko .align-right>p {
  text-align: right !important;
}

.madoko .align-right>* {
  margin-left: auto !important;
  margin-right: 0pt !important;
}

.madoko .align-center>table,
.madoko .align-left>table,
.madoko .align-right>table {
  text-align: left !important;
}


/* Equations, Figure's etc. */
.madoko .equation-before {
  float: right;
}


/* Bibliography */
.madoko .bibitem {
  font-size: smaller;
}

.madoko .bib-numeric .bibitem {
  margin-left: 3em;
  text-indent: -3em;
}

.madoko .bibitem-before {
  display: none;
}

.madoko .bib-numeric .bibitem-before {
  display: inline-block;
  width: 3em;
  text-align: right;
}

.madoko .bibliography {
}

.madoko .bibsearch {
  font-size: x-small;
  text-decoration:none;
  color: black;
  font-family: "Segoe UI Symbol", Symbola;
}

/* General */
.madoko .block, .madoko .figure, .madoko .bibitem, .madoko .equation, .madoko div.math {
  margin-top: 1ex;
  margin-bottom: 1ex;
}

.madoko .figure {
  padding: 0.5em;
  margin-left: 0pt;
  margin-right: 0pt;
}

.madoko .hidden {
  display: none;
}

.madoko .invisible {
  visibility: hidden;
}

.madoko.preview .invisible {
  visibility: visible;
  opacity: 0.5;
}

.madoko code.code, .madoko span.code {
  white-space: pre-wrap;
}

.madoko hr, hr.madoko {
  border: none;
  border-bottom: black solid 1px;
  margin-bottom: 0.5ex;
}

.madoko .framed>*:first-child {
  margin-top: 0pt;
}
.madoko .framed>*:last-child {
  margin-bottom: 0pt;
}


/* Title, authors */
.madoko .title {
  font-size: xx-large;
  font-weight: bold;
  margin-bottom: 1ex;
}

.madoko .subtitle {
  font-size: x-large;
  margin-bottom: 1ex;
  margin-top: -1ex;
}

.madoko .titleblock>* {
  margin-left: auto;
  margin-right: auto;
  text-align: center;
}

.madoko .titleblock table {
  width: 80%;
}

.madoko .authorblock .author {
  font-size: large;
}

.madoko .titlenote {
  margin-top: -0.5ex;
  margin-bottom: 1.5ex;
}

/* Lists */

.madoko ul.list-star {
  list-style-type: disc;
}

.madoko ul.list-dash {
    list-style-type: none !important;
}

.madoko ul.list-dash > li:before {
    content: "\2013"; 
    position: absolute;
    margin-left: -1em; 
}

.madoko ul.list-plus {
  list-style-type: square;
}

/* Tables */
.madoko table.madoko {
  border-collapse: collapse;
}
.madoko td, .madoko th {
  padding: 0ex 0.5ex;
  margin: 0pt;
  vertical-align: top;
}

.madoko .cell-border-left {
  border-left: 1px solid black;
}
.madoko .cell-border-right {
  border-right: 1px solid black;
}


.madoko thead>tr:first-child>.cell-line,
.madoko tbody:first-child>tr:first-child>.cell-line {
  border-top: 1px solid black;
  border-bottom: none;
}

.madoko .cell-line, .madoko .cell-double-line {
  border-bottom: 1px solid black;
  border-top: none;
}

.madoko .cell-double-line {
  border-top: 1px solid black;
  padding-top: 1.5px !important;
}


/* Math Pre */
.madoko .input-mathpre .MathJax_Display {
  text-align: left !important;
}

.madoko div.input-mathpre {
  text-align: left;
  margin-top: 1.5ex;
  margin-bottom: 1ex;
}

.madoko .math-rendering {
  color: gray;
}

/* Math */
.madoko .mathdisplay {
  text-align: center;
}


/*---------------------------------------------------------------------------
  Default style for syntax highlighting
---------------------------------------------------------------------------*/

.highlighted                        { color: black; }
.highlighted .token.identifier      { }
.highlighted .token.operators       { }
.highlighted .token.keyword         { color: blue }
.highlighted .token.string          { color: maroon } 
.highlighted .token.string.escape   { color: gray }
.highlighted .token.comment         { color: darkgreen }
.highlighted .token.comment.doc     { font-style: normal }
.highlighted .token.constant        { color: purple; }
.highlighted .token.entity          {  }
.highlighted .token.tag             { color: blue }
.highlighted .token.info-token      { color: black }
.highlighted .token.warn-token      { color: black }
.highlighted .token.error-token     { color: darkred }
.highlighted .token.debug-token     { color: gray }
.highlighted .token.regexp          { color: maroon }
.highlighted .token.attribute.name  { color: navy }
.highlighted .token.attribute.value { color: maroon }
.highlighted .token.constructor     { color: purple }
.highlighted .token.namespace       { color: navy }
.highlighted .token.header          { color: navy }
.highlighted .token.type            { color: teal } 
.highlighted .token.type.delimiter  { color: teal; } 
.highlighted .token.predefined      { color: navy }
.highlighted .token.invalid         { border-bottom: red dotted 1px }
.highlighted .token.code            { color: maroon }
.highlighted .token.code.keyword    { color: navy }
.highlighted .token.typevar         { font-style: italic; }

.highlighted .token.delimiter   {  } /* .[curly,square,parenthesis,angle,array,bracket] */
.highlighted .token.number      {  }    /* .[hex,octal,binary,float] */
.highlighted .token.variable    {  }  /* .[name,value]  */
.highlighted .token.meta        { color: navy }      /* .[content] */

.highlighted .token.bold            { font-weight: bold; }
.highlighted .token.italic          { font-style: italic; }


/* Pretty formatting of code */
.madoko pre.pretty, .madoko code.pretty { 
  font-family: Cambria,Times,Georgia,serif;
  font-size: 100%;
}

.madoko .pretty table {
  border-collapse: collapse;
}
.madoko .pretty td {
  padding: 0em;
}
.madoko .pretty td.empty {
  min-width: 1.5ex;
}
.madoko .pretty td.expander {
  width: 100em;
}
.madoko .pretty .token.identifier         { font-style: italic }
.madoko .pretty .token.constructor        { font-style: italic }


/* ---------------------------------------------------
   Styling for full documents
----------------------------------------------------*/
body.madoko, .madoko-body {
  font-family: Cambria,"Times New Roman","Liberation Serif","Times",serif;
  -webkit-text-size-adjust: 100%; /* so math displays well on mobile devices */
}

body.madoko, .madoko-body {
  padding: 0em 2em;
  max-width: 88ex; /* about 88 characters */
  margin: 1em auto;
}

body.madoko.preview {
  padding: 0em 1em;
}

.madoko p,
.madoko li {
  text-align: justify;
}

/* style headings nicer, especially h5 and h6 */
.madoko h1, .madoko h2, .madoko h3, .madoko h4 { 
  margin-top: 1.22em; 
  margin-bottom: 1ex;
}
.madoko h1+p, .madoko h2+p, .madoko h3+p, .madoko h4+p, .madoko h5+p  { 
  margin-top: 1ex;    
}
.madoko h5, .madoko h6 { 
  margin-top: 1ex;
  font-size: 1em;
}
.madoko h5 { 
  margin-bottom: 0.5ex;
}
.madoko h5 + p {
  margin-top: 0.5ex;
}
.madoko h6 { 
  margin-bottom: 0pt;
}
.madoko h6 + p {
  margin-top: 0pt;
}


/* Fix monospace display (see http://code.stephenmorley.org/html-and-css/fixing-browsers-broken-monospace-font-handling/) */
.madoko pre, .madoko code, .madoko kbd, .madoko samp, .madoko tt, .madoko .monospace, .madoko .token.indent, .madoko .reveal pre, .madoko .reveal code, .madoko .email {
  font-family: Consolas,"Andale Mono WT","Andale Mono",Lucida Console,Monaco,monospace,monospace;
  font-size: 0.85em;
}
.madoko pre code, .madoko .token.indent {
  font-size: 0.95em;
}

.madoko pre code {
  font-family: inherit !important;
}

/* Code prettify */
.madoko ol.linenums li {
  background-color: white;
  list-style-type: decimal;
}

/* Merging */
.madoko .remote {
  background-color: #F0FFF0;
}
.madoko .remote + * {
  margin-top: 0pt;
}

/* ---------------------------------------------------
   Print settings
----------------------------------------------------*/

@media print {
  body.madoko, .madoko-body {
    font-size: 10pt;
  }
  @page {
    margin: 1in 1.5in;
  }
}

/* ---------------------------------------------------
   Mobile device settings
----------------------------------------------------*/

@media only screen and (max-device-width:1024px) {
  body.madoko, .madoko-body {
    padding: 0em 1em;
  }
}

  </style>

</head>
<body class="madoko madoko-body">


<div class="mathdefs hidden input-mathdefs" data-line="10"></div><h2 id="sec-an-introduction-to-wyvern"  data-line="16"  style="bookmark:1.&#8194;An Introduction to Wyvern"><span data-line="16"></span><span class="heading-before"><span class="heading-label">1</span>.&#8194;</span><span data-line="16"></span>An Introduction to Wyvern</h2>
<p data-line="19"><span data-line="19"></span>Here is a <span data-line="19"></span>&#8220;Hello, World!&#8221;<span data-line="19"></span> program in Wyvern:
</p>
<pre class="para-block pre-indented" data-line="21"><code>require stdout

stdout.print(&quot;Hello, World!&quot;)</code></pre>
<p data-line="25"><span data-line="25"></span>This program already illustrates several basic aspects of Wyvern.  First,
Wyvern is object-oriented: <span data-line="26"></span><code class="code code1">stdout</code><span data-line="26"></span> is an object, and we are invoking the
<span data-line="27"></span><code class="code code1">print</code><span data-line="27"></span> method on it.  For expressions, much of Wyvern<span data-line="27"></span>&#39;<span data-line="27"></span>s syntax is similar
to Java<span data-line="28"></span>&#39;<span data-line="28"></span>s.
</p>
<p class="indent" data-line="30"><span data-line="30"></span>A second notable feature of Wyvern illustrateed by this program is that
the <span data-line="31"></span><code class="code code1">stdout</code><span data-line="31"></span> object is not ambiently available to programs, nor can it be
imported in the sense of a Java <span data-line="32"></span><code class="code code1">import</code><span data-line="32"></span> statement.  Because <span data-line="32"></span><code class="code code1">stdout</code><span data-line="32"></span>
does I/O, it is a <span data-line="33"></span><em>resource</em><span data-line="33"></span>.  A primary goal of Wyvern<span data-line="33"></span>&#39;<span data-line="33"></span>s module system
is helping developers to reason about the use of resources.  Thus even
a simple script such as Hello World must declare the resources it
requires in order to execute.  This allows engineers to determine at a
glance what kind of I/O a program might do, and provides a basis for
making a decision about whether to run this program in a particular
situation.  In this case, even without looking at the actual code, we
know that this program may write to the standard output stream, but will
not access the file system or access the network.
</p><h2 id="sec-objects-and-modules-in-wyvern"  data-line="44"  style="bookmark:2.&#8194;Objects and Modules in Wyvern"><span data-line="44"></span><span class="heading-before"><span class="heading-label">2</span>.&#8194;</span><span data-line="44"></span>Objects and Modules in Wyvern</h2>
<p data-line="47"><span data-line="47"></span>Let us further illustrate objects and modules in Wyvern through a simple
logging module:
</p>
<pre class="para-block pre-indented" data-line="50"><code>resource module logging

import wyvern.collections.list
require files

resource type Log
    def log(x:String):Unit

def makeLog(path:String):Log
    val logFile = files.openForAppend(path)
    val messageList = list.make()
    new
        def log(x:String):Unit
            messageList.append(x)
            logFile.print(x)</code></pre>
<p data-line="66"><span data-line="66"></span>A module starts with the module keyword and a name that denotes the module.
The logging module needs access to the
file system in order to write to log files, so it declares that it
requires the <span data-line="69"></span><code class="code code1">files</code><span data-line="69"></span> resource.  Because this module requires a 
resource, it becomes a resource itself, in that other modules can use
it to access the file system via log-related operations.  Thus we must
declare it to be a <span data-line="72"></span><code class="code code1">resource</code><span data-line="72"></span> module.
</p>
<p class="indent" data-line="74"><span data-line="74"></span>In our example, the log stores logged messages in an internal list,
perhaps so it can be accessed programmatically (through an interface
not shown here).  Thus we need to <span data-line="76"></span><code class="code code1">import</code><span data-line="76"></span> a <span data-line="76"></span><code class="code code1">list</code><span data-line="76"></span> abstraction.
We could <span data-line="77"></span><code class="code code1">require</code><span data-line="77"></span> the <span data-line="77"></span><code class="code code1">list</code><span data-line="77"></span> module, but this is unnecessary: the
<span data-line="78"></span><code class="code code1">list</code><span data-line="78"></span> module does not provide any access to I/O, and it does not
have any internal state (<span data-line="79"></span><code class="code code1">List</code><span data-line="79"></span> objects created by the <span data-line="79"></span><code class="code code1">list</code><span data-line="79"></span> module
are stateful in our example, but that is not relevant for module
imports).  It is thus not a resource module, and can therefore be
used by any module in the program with a simple <span data-line="82"></span><code class="code code1">import</code><span data-line="82"></span> statement
similar to Java<span data-line="83"></span>&#39;<span data-line="83"></span>s.
</p>
<p class="indent" data-line="85"><span data-line="85"></span>The import statement uses a fully-qualified name similar to package
names in Java (in the future, this fully-qualified name will be given
at the head of the module definition, rather than just a simple name,
but this is not fully specified or implemented yet).
A protocol similar to Java<span data-line="89"></span>&#39;<span data-line="89"></span>s is used to find a file defining that module:
specifically, we check the library directory and the current directory
for subdirectories named by the qualifier and search recursively down
until we find the file list.wyv.  In this example, the library directory
is tools/src/wyvern/lib and so the import statement binds to the file
wyvern/collections/list.wyv within this directory tree.
</p>
<p class="indent" data-line="96"><span data-line="96"></span>Next, we declare a type for <span data-line="96"></span><code class="code code1">Log</code><span data-line="96"></span> objects.  The interface is pretty
simple: a single method <span data-line="97"></span><code class="code code1">log</code><span data-line="97"></span> taking a <span data-line="97"></span><code class="code code1">String</code><span data-line="97"></span> argument is
defined using the <span data-line="98"></span><code class="code code1">def</code><span data-line="98"></span> keyword.
The return type of <span data-line="99"></span><code class="code code1">Unit</code><span data-line="99"></span>&#8211;<span data-line="99"></span>equivalent to <span data-line="99"></span><code class="code code1">void</code><span data-line="99"></span> in Java<span data-line="99"></span>&#8211;<span data-line="99"></span>is specified
at the end of the method declaration.
Note that the members of the <span data-line="101"></span><code class="code code1">Log</code><span data-line="101"></span>
type are described in indented lines, rather than (for example)
within curly braces.  We mark the type as being a resource type,
again because a <span data-line="104"></span><code class="code code1">Log</code><span data-line="104"></span> object encapsulates the ability to write to
a particular log file.
</p>
<p class="indent" data-line="107"><span data-line="107"></span>Finally, we define a <span data-line="107"></span><code class="code code1">makeLog</code><span data-line="107"></span> method in order to create a <span data-line="107"></span><code class="code code1">Log</code><span data-line="107"></span>
object.
The implementation of the function is given in indented lines.  The
first line declares a local variable, <span data-line="110"></span><code class="code code1">logFile</code><span data-line="110"></span>, which is the file
we will be logging to.  Likewise, we declare a variable for the list
where we will store the log messages.  The last line that is indented
at the function implementation level is returned by the function<span data-line="113"></span>&#8211;<span data-line="113"></span>in
this case a <span data-line="114"></span><code class="code code1">new</code><span data-line="114"></span> expression  that actually creates the <span data-line="114"></span><code class="code code1">Log</code><span data-line="114"></span> object.
The type of object to be created is inferred based on the return type
of the method.  We implement the object<span data-line="116"></span>&#39;<span data-line="116"></span>s methods in indented lines
following the <span data-line="117"></span><code class="code code1">new</code><span data-line="117"></span> expression.
</p>
<p class="indent" data-line="120"><span data-line="120"></span>Now we can write a program that uses the logging module:
</p>
<pre class="para-block pre-indented" data-line="122"><code>require files
import examples.logging
import examples.logApplication

val logger = logging(files)
val client = logApplication(logger)

client.run()
</code></pre>
<p data-line="131"><span data-line="131"></span>Since the <span data-line="131"></span><code class="code code1">logging</code><span data-line="131"></span> module defined earlier requires a
<span data-line="132"></span><code class="code code1">files</code><span data-line="132"></span> in order to operate, and since <span data-line="132"></span><code class="code code1">files</code><span data-line="132"></span> represents a resource
that we can only get from the operating system, our program must also
<span data-line="134"></span><code class="code code1">require files</code><span data-line="134"></span>.  We can then import the code for the <span data-line="134"></span><code class="code code1">logging</code><span data-line="134"></span> module
(specifying the fully qualified location <span data-line="135"></span><code class="code code1">examples.logging</code><span data-line="135"></span>) and then
instantiate the code by passing the <span data-line="136"></span><code class="code code1">files</code><span data-line="136"></span> module to fulfill its
requirement.  We bind the resulting instantiated module to <span data-line="137"></span><code class="code code1">logger</code><span data-line="137"></span>,
which we can use in the rest of the code as if it were an object.
</p>
<p class="indent" data-line="140"><span data-line="140"></span>The main program that uses the <span data-line="140"></span><code class="code code1">logger</code><span data-line="140"></span> is defined in a module
<span data-line="141"></span><code class="code code1">examples.logApplication</code><span data-line="141"></span> (not shown).  It requires the <span data-line="141"></span><code class="code code1">logger</code><span data-line="141"></span>
and so we must instantiate <span data-line="142"></span><code class="code code1">logApplication</code><span data-line="142"></span> with the <span data-line="142"></span><code class="code code1">logger</code><span data-line="142"></span> as
an argument, and then bind the result to the name <span data-line="143"></span><code class="code code1">client</code><span data-line="143"></span>.
We can then execute the application code by invoking <span data-line="144"></span><code class="code code1">client.run()</code><span data-line="144"></span>.
</p><h2 id="sec-reasoning-about-security-in-wyvern"  data-line="148"  style="bookmark:3.&#8194;Reasoning about Security in Wyvern"><span data-line="148"></span><span class="heading-before"><span class="heading-label">3</span>.&#8194;</span><span data-line="148"></span>Reasoning about Security in Wyvern</h2>
<p data-line="151"><span data-line="151"></span>The program code above is notable for the security analysis it
facilitates based on the principle of least privilege.  The overall
program requires the <span data-line="153"></span><code class="code code1">files</code><span data-line="153"></span> resource, but the only use of this
resource is to instantiate the <span data-line="154"></span><code class="code code1">logging</code><span data-line="154"></span> module.  Wyvern is a
capability-safe language, so the <span data-line="155"></span><code class="code code1">logApplication</code><span data-line="155"></span> module cannot
ambiently import the <span data-line="156"></span><code class="code code1">files</code><span data-line="156"></span> without getting permission from
the main module.  Furthermore, Wyvern does not provide unconstrained global
state which could, in a language like Java, be used to share the
<span data-line="159"></span><code class="code code1">files</code><span data-line="159"></span> between modules in a hard-to-analyze way.  We can
conclude that <span data-line="160"></span><code class="code code1">logApplication</code><span data-line="160"></span> does not directly use the <span data-line="160"></span><code class="code code1">files</code><span data-line="160"></span>
simply by observing that it is not passed to <span data-line="161"></span><code class="code code1">logApplication</code><span data-line="161"></span> upon
instantiation, and further observing that it is not exposed
in the interface of the <span data-line="163"></span><code class="code code1">logging</code><span data-line="163"></span> module.
</p>
<p class="indent" data-line="165"><span data-line="165"></span>Of course, <span data-line="165"></span><code class="code code1">logApplication</code><span data-line="165"></span> can write to a log file by using the
<span data-line="166"></span><code class="code code1">logging</code><span data-line="166"></span> module, and this is a use of the file system.  But
by our knowledge of the <span data-line="167"></span><code class="code code1">logging</code><span data-line="167"></span> module, or by a brief inspection
of its code, we can see that it provides only a restricted mode of
use of the file system: reading files is not permitted, and writing
files is only possible in append mode.  A refinement of the
<span data-line="171"></span><code class="code code1">logging</code><span data-line="171"></span> module could impose additional restrictions, such as
restricting log writes to particular directories.
</p>
<p class="indent" data-line="174"><span data-line="174"></span>Thus the combination of the capability-safe nature of the Wyvern
language, the <span data-line="175"></span><code class="code code1">require</code><span data-line="175"></span> construct, and the careful structuring
of the source program, we get a strong guarantee about the behavior
of <span data-line="177"></span><code class="code code1">logApplication</code><span data-line="177"></span>: the only I/O effect it has is logging, which is
a refinement of file system access, which is a refinement of
general I/O.  Furthermore, we paid a relatively low cost to
facilitate this reasoning.  In the <span data-line="180"></span><code class="code code1">logging</code><span data-line="180"></span> module (and in
<span data-line="181"></span><code class="code code1">logApplication</code><span data-line="181"></span>, if we were to examine it) the code is no more
verbose than you would expect of code in another typed language
such as Java: basically we just have to use the <span data-line="183"></span><code class="code code1">require</code><span data-line="183"></span> keyword
in place of <span data-line="184"></span><code class="code code1">import</code><span data-line="184"></span> and we have to mark types and modules
with the <span data-line="185"></span><code class="code code1">resource</code><span data-line="185"></span> keyword as appropriate.  The overhead in the
main module is a substantially higher, as we have to instantiate
modules explicitly and thread resources through them.
</p>
<p class="indent" data-line="189"><span data-line="189"></span><strong>Note:</strong><span data-line="189"></span> The logging example above does not run yet.  In
particular, we have not yet implemented the <span data-line="190"></span><code class="code code1">files</code><span data-line="190"></span> module.
</p><h2 id="sec-module-bodies"  data-line="194"  style="bookmark:4.&#8194;Module Bodies"><span data-line="194"></span><span class="heading-before"><span class="heading-label">4</span>.&#8194;</span><span data-line="194"></span>Module Bodies</h2>
<p data-line="197"><span data-line="197"></span>Module bodies are made up of four kinds of core declarations: <span data-line="197"></span><code class="code code1">val</code><span data-line="197"></span>,
<span data-line="198"></span><code class="code code1">var</code><span data-line="198"></span>, <span data-line="198"></span><code class="code code1">def</code><span data-line="198"></span>, and <span data-line="198"></span><code class="code code1">type</code><span data-line="198"></span>, as well as expressions.  The <span data-line="198"></span><code class="code code1">val</code><span data-line="198"></span> and
<span data-line="199"></span><code class="code code1">var</code><span data-line="199"></span> declarations and the expressions in a module body are evaluated
in sequence, and the variables defined earlier in the sequence are
in scope in later declarations and expressions.  In contrast,
<span data-line="202"></span><code class="code code1">def</code><span data-line="202"></span> and <span data-line="202"></span><code class="code code1">type</code><span data-line="202"></span> declarations do not evaluate, and therefore these
declaration forms can be safely used to define mutually recursive
functions and types.  Each sequence of declarations that consists
exclusively of <span data-line="205"></span><code class="code code1">def</code><span data-line="205"></span> and <span data-line="205"></span><code class="code code1">type</code><span data-line="205"></span> is therefore treated as a mutually
recursive block, so that the definition or type defined in each of
the declarations is in scope in all the other declarations.
</p>
<p class="indent" data-line="209"><span data-line="209"></span>To understand why we allow recursive <span data-line="209"></span><code class="code code1">def</code><span data-line="209"></span> and <span data-line="209"></span><code class="code code1">type</code><span data-line="209"></span> declarations
but do not allow this for <span data-line="210"></span><code class="code code1">val</code><span data-line="210"></span> and <span data-line="210"></span><code class="code code1">var</code><span data-line="210"></span> declarations, consider
the following example:
</p>
<pre class="para-block pre-indented" data-line="213"><code>def foo() = baz()
val bar = foo()
def baz() = bar</code></pre>
<p data-line="217"><span data-line="217"></span>When we try to initialize the <span data-line="217"></span><code class="code code1">bar</code><span data-line="217"></span> value, we call <span data-line="217"></span><code class="code code1">foo()</code><span data-line="217"></span>, which in
turn invokes <span data-line="218"></span><code class="code code1">baz()</code><span data-line="218"></span>.  However, <span data-line="218"></span><code class="code code1">baz()</code><span data-line="218"></span> reads the <span data-line="218"></span><code class="code code1">bar</code><span data-line="218"></span> variable, which
is what we are defining, so there is no well-defined result.  Languages
such as Java handle this by initializing <span data-line="220"></span><code class="code code1">bar</code><span data-line="220"></span> to <span data-line="220"></span><code class="code code1">null</code><span data-line="220"></span> at first and
then writing a permanent value to it after the initializer executes.
However, in order to avoid null pointer errors, Wyvern does not allow
<span data-line="223"></span><code class="code code1">null</code><span data-line="223"></span> as a value.  Languages such as Haskell would use a special
<span data-line="224"></span>&#8220;black hole&#8221;<span data-line="224"></span> value and signal a run-time error in cases such as the
above.  We avoid this semantics as it adds complexity and means the
program can fail at run time.  Of course, infinite loops can still
exist in Wyvern, but they come from recursive functions, never
recursively defined values.
</p><h2 id="sec-anonymous-functions"  data-line="231"  style="bookmark:5.&#8194;Anonymous Functions"><span data-line="231"></span><span class="heading-before"><span class="heading-label">5</span>.&#8194;</span><span data-line="231"></span>Anonymous Functions</h2>
<p data-line="234"><span data-line="234"></span>Anonymous functions can be defined in Wyvern using the syntax:
</p>
<pre class="para-block pre-indented" data-line="236"><code>(x:Int) =&gt; x + 1</code></pre>
<p data-line="238"><span data-line="238"></span>This is a shorthand for creating an object with an <span data-line="238"></span><code class="code code1">apply</code><span data-line="238"></span> method
that has the same arguments and body:
</p>
<pre class="para-block pre-indented" data-line="241"><code>new
    def apply(x:Int):Int = x + 1</code></pre>
<p data-line="244"><span data-line="244"></span>which is an instance of the following type:
</p>
<pre class="para-block pre-indented" data-line="246"><code>type IntToIntFn
    def apply(x:Int):Int</code></pre>
<p data-line="249"><span data-line="249"></span>Anonymous functions can also have multiple parameters:
</p>
<pre class="para-block pre-indented" data-line="251"><code>(x:Int,y:Int) =&gt; x + y
</code></pre>
<p data-line="253"><span data-line="253"></span>or no parameters:
</p>
<pre class="para-block pre-indented" data-line="255"><code>() =&gt; 7</code></pre>
<p data-line="257"><span data-line="257"></span>We expect to define a convenient shorthand for function types in the near future.
</p>
<div class="logomadoko block" data-line="260" style="text-align:right;font-size:xx-small;margin-top:4em"><span data-line="261"></span>Created with&nbsp;<a href="https://www.madoko.net">Madoko.net</a>.</div><span data-line=""></span>
</body>

</html>
